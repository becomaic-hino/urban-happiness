<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YJ ë‹¤ì´ì–´íŠ¸ ì¼ì§€ - ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ë™</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .sync-status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .sync-indicator.disconnected {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .daily-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #666;
            font-size: 0.8rem;
        }

        .summary-target {
            font-size: 0.7rem;
            color: #999;
            margin-top: 3px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
        }

        .tab {
            flex: 1;
            padding: 12px 8px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
        }

        .quick-add-section {
            padding: 20px;
        }

        .meal-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .meal-btn {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .meal-btn:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .meal-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .current-meal-foods {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 80px;
        }

        .current-meal-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .current-meal-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .meal-food-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .food-info {
            flex: 1;
        }

        .food-name {
            font-weight: 500;
            color: #333;
        }

        .food-details {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }

        .food-calories {
            font-weight: 600;
            color: #ff6b6b;
            margin-right: 10px;
        }

        .remove-food-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            font-size: 0.9rem;
        }

        .food-input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .nutrition-input {
            text-align: center;
        }

        .nutrition-input label {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .nutrition-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 0.8rem;
        }

        .add-food-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .add-food-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .save-meal-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .save-meal-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .save-meal-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .google-sheets-setup {
            padding: 20px;
        }

        .setup-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .setup-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .setup-steps {
            list-style: none;
            padding: 0;
        }

        .setup-steps li {
            padding: 8px 0;
            color: #555;
            position: relative;
            padding-left: 25px;
        }

        .setup-steps li::before {
            content: "âœ…";
            position: absolute;
            left: 0;
        }

        .connection-input {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #cce7ff;
            color: #0066cc;
            border: 1px solid #99d6ff;
        }

        .favorite-foods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .favorite-food-btn {
            padding: 10px 8px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .favorite-food-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .daily-summary { grid-template-columns: repeat(2, 1fr); }
            .input-group { grid-template-columns: 1fr; }
            .nutrition-grid { grid-template-columns: repeat(2, 1fr); }
            .meal-selector { grid-template-columns: repeat(2, 1fr); }
            .connection-input { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ YJ ë‹¤ì´ì–´íŠ¸ ì¼ì§€</h1>
            <p>í•œ ë¼ì— ì—¬ëŸ¬ ìŒì‹ ì…ë ¥ ê°€ëŠ¥ + êµ¬ê¸€ì‹œíŠ¸ ìë™ ì—°ë™</p>
        </div>

        <div class="sync-status">
            <div class="sync-indicator" id="syncIndicator"></div>
            <span id="syncStatus">êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ê²° í•„ìš”</span>
        </div>

        <div class="daily-summary">
            <div class="summary-card">
                <div class="summary-value" id="todayCalories">0</div>
                <div class="summary-label">ì˜¤ëŠ˜ ì¹¼ë¡œë¦¬</div>
                <div class="summary-target">ëª©í‘œ: 1500kcal</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="calorieProgress"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="todayCarbs">0g</div>
                <div class="summary-label">íƒ„ìˆ˜í™”ë¬¼</div>
                <div class="summary-target">45-50%</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="todayProtein">0g</div>
                <div class="summary-label">ë‹¨ë°±ì§ˆ</div>
                <div class="summary-target">ëª©í‘œ: 70g</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="todayFat">0g</div>
                <div class="summary-label">ì§€ë°©</div>
                <div class="summary-target">20-25%</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="todayMood">ğŸ˜</div>
                <div class="summary-label">ì˜¤ëŠ˜ ê¸°ë¶„</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('food')">ğŸ½ï¸ ì‹ì‚¬ê¸°ë¡</button>
            <button class="tab" onclick="switchTab('sheets')">ğŸ“Š êµ¬ê¸€ì‹œíŠ¸</button>
            <button class="tab" onclick="switchTab('settings')">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- ì‹ì‚¬ ê¸°ë¡ íƒ­ -->
        <div id="food" class="tab-content active">
            <div class="quick-add-section">
                <div class="meal-selector">
                    <button class="meal-btn active" data-meal="breakfast">ğŸŒ… ì•„ì¹¨</button>
                    <button class="meal-btn" data-meal="lunch">â˜€ï¸ ì ì‹¬</button>
                    <button class="meal-btn" data-meal="dinner">ğŸŒ™ ì €ë…</button>
                    <button class="meal-btn" data-meal="snack">ğŸ¿ ê°„ì‹</button>
                </div>

                <!-- í˜„ì¬ ì‹ì‚¬ì— ì¶”ê°€ëœ ìŒì‹ë“¤ -->
                <div class="current-meal-foods">
                    <div class="current-meal-title">ğŸŒ… ì•„ì¹¨ ë©”ë‰´</div>
                    <div class="current-meal-list" id="currentMealList">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            ì•„ì§ ì¶”ê°€ëœ ìŒì‹ì´ ì—†ì–´ìš”
                        </div>
                    </div>
                </div>

                <!-- ì¦ê²¨ì°¾ëŠ” ìŒì‹ ë¹ ë¥¸ ì¶”ê°€ -->
                <div style="margin-bottom: 15px;">
                    <h4 style="margin-bottom: 10px; color: #666;">â­ ìì£¼ ë¨¹ëŠ” ìŒì‹ (í„°ì¹˜í•´ì„œ ì¶”ê°€)</h4>
                    <div class="favorite-foods" id="favoriteFoods">
                        <!-- ì¦ê²¨ì°¾ëŠ” ìŒì‹ë“¤ì´ ì—¬ê¸° ì¶”ê°€ë¨ -->
                    </div>
                </div>

                <div class="food-input-section">
                    <h4 style="margin-bottom: 15px; color: #666;">ğŸ†• ìƒˆ ìŒì‹ ì¶”ê°€</h4>
                    <div class="input-group">
                        <input type="text" id="foodName" placeholder="ìŒì‹ ì´ë¦„ (ì˜ˆ: í˜„ë¯¸ë°¥, ë‹­ê°€ìŠ´ì‚´)">
                        <input type="number" id="foodAmount" placeholder="ì–‘ (g)">
                        <select id="foodUnit">
                            <option value="g">ê·¸ë¨(g)</option>
                            <option value="ê°œ">ê°œ</option>
                            <option value="ê·¸ë¦‡">ê·¸ë¦‡</option>
                            <option value="ì»µ">ì»µ</option>
                            <option value="ìˆŸê°ˆ">ìˆŸê°ˆ</option>
                        </select>
                    </div>

                    <div class="nutrition-grid">
                        <div class="nutrition-input">
                            <label>ì¹¼ë¡œë¦¬</label>
                            <input type="number" id="calories" placeholder="200">
                        </div>
                        <div class="nutrition-input">
                            <label>íƒ„ìˆ˜í™”ë¬¼(g)</label>
                            <input type="number" id="carbs" placeholder="30">
                        </div>
                        <div class="nutrition-input">
                            <label>ë‹¨ë°±ì§ˆ(g)</label>
                            <input type="number" id="protein" placeholder="25">
                        </div>
                        <div class="nutrition-input">
                            <label>ì§€ë°©(g)</label>
                            <input type="number" id="fat" placeholder="5">
                        </div>
                        <div class="nutrition-input">
                            <label>ë‚˜íŠ¸ë¥¨(mg)</label>
                            <input type="number" id="sodium" placeholder="500">
                        </div>
                        <div class="nutrition-input">
                            <label>ë‹¹ë¶„(g)</label>
                            <input type="number" id="sugar" placeholder="10">
                        </div>
                    </div>

                    <button class="add-food-btn" onclick="addFoodToCurrentMeal()">â• í˜„ì¬ ì‹ì‚¬ì— ì¶”ê°€</button>
                    <button class="save-meal-btn" onclick="saveMealToGoogleSheets()" id="saveMealBtn" disabled>
                        ğŸ“Š êµ¬ê¸€ì‹œíŠ¸ì— ì‹ì‚¬ ì €ì¥
                    </button>
                </div>
            </div>
        </div>

        <!-- êµ¬ê¸€ì‹œíŠ¸ ì—°ë™ íƒ­ -->
        <div id="sheets" class="tab-content">
            <div class="google-sheets-setup">
                <div class="setup-card">
                    <div class="setup-title">ğŸ“Š êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ë™ ì„¤ì •</div>
                    <p style="color: #666; margin-bottom: 15px;">
                        êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì™€ ì—°ë™í•˜ë©´ ì…ë ¥í•œ ëª¨ë“  ì‹ì‚¬ ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ì €ì¥ë˜ê³  ë¶„ì„ë©ë‹ˆë‹¤.
                    </p>
                    
                    <h4 style="margin: 15px 0 10px 0; color: #333;">ğŸ”§ ì„¤ì • ë°©ë²•:</h4>
                    <ul class="setup-steps">
                        <li>êµ¬ê¸€ ë“œë¼ì´ë¸Œì—ì„œ ìƒˆ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±</li>
                        <li>ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URLì—ì„œ ID ë³µì‚¬ (ì˜ˆ: 1ABC...XYZ ë¶€ë¶„)</li>
                        <li>ì•„ë˜ ì…ë ¥ì°½ì— ID ì…ë ¥í•˜ê³  ì—°ê²°</li>
                        <li>ì²« ë²ˆì§¸ ì‹œíŠ¸ì— ìë™ìœ¼ë¡œ í—¤ë”ê°€ ìƒì„±ë©ë‹ˆë‹¤</li>
                    </ul>
                </div>

                <div class="connection-input">
                    <input type="text" id="spreadsheetId" placeholder="ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <button class="add-food-btn" onclick="connectGoogleSheet()">ğŸ”— ì—°ê²°</button>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: #333;">ğŸ“‹ ì €ì¥ë˜ëŠ” ë°ì´í„°:</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.9rem;">
                        ë‚ ì§œ, ì‹œê°„, ì‹ì‚¬ì¢…ë¥˜, ìŒì‹ëª…, ì–‘, ì¹¼ë¡œë¦¬, íƒ„ìˆ˜í™”ë¬¼, ë‹¨ë°±ì§ˆ, ì§€ë°©, ë‚˜íŠ¸ë¥¨, ë‹¹ë¶„, ê¸°ë¶„, ë©”ëª¨
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="add-food-btn" onclick="testConnection()" style="background: #17a2b8;">
                        ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                </div>
            </div>
        </div>

        <!-- ì„¤ì • íƒ­ -->
        <div id="settings" class="tab-content">
            <div class="quick-add-section">
                <h3 style="margin-bottom: 15px;">âš™ï¸ ê°œì¸ ì„¤ì •</h3>
                
                <div class="food-input-section">
                    <h4 style="margin-bottom: 10px;">ğŸ¯ ëª©í‘œ ì„¤ì •</h4>
                    <div class="nutrition-grid">
                        <div class="nutrition-input">
                            <label>ëª©í‘œ ì¹¼ë¡œë¦¬</label>
                            <input type="number" id="targetCalories" value="1500">
                        </div>
                        <div class="nutrition-input">
                            <label>ëª©í‘œ ë‹¨ë°±ì§ˆ(g)</label>
                            <input type="number" id="targetProtein" value="70">
                        </div>
                        <div class="nutrition-input">
                            <label>ëª©í‘œ ì²´ì¤‘(kg)</label>
                            <input type="number" id="targetWeight" value="65" step="0.1">
                        </div>
                        <div class="nutrition-input">
                            <label>í˜„ì¬ ì²´ì¤‘(kg)</label>
                            <input type="number" id="currentWeight" value="77.8" step="0.1">
                        </div>
                    </div>
                    <button class="add-food-btn" onclick="saveSettings()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                </div>

                <div class="food-input-section">
                    <h4 style="margin-bottom: 10px;">â­ ì¦ê²¨ì°¾ëŠ” ìŒì‹ ê´€ë¦¬</h4>
                    <div class="input-group">
                        <input type="text" id="newFavoriteFood" placeholder="ìŒì‹ëª…">
                        <input type="number" id="newFavoriteCalories" placeholder="ì¹¼ë¡œë¦¬">
                        <button class="add-food-btn" onclick="addFavoriteFood()">ì¶”ê°€</button>
                    </div>
                    <div id="favoriteFoodsList" style="margin-top: 15px;">
                        <!-- ì¦ê²¨ì°¾ëŠ” ìŒì‹ ëª©ë¡ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentMeal = 'breakfast';
        let currentMealFoods = [];
        let settings = JSON.parse(localStorage.getItem('dietSettings') || '{"targetCalories": 1500, "targetProtein": 70, "targetWeight": 65, "currentWeight": 77.8, "spreadsheetId": ""}');
        let favoriteFoods = JSON.parse(localStorage.getItem('favoriteFoods') || '[]');
        let dailyTotals = { calories: 0, carbs: 0, protein: 0, fat: 0, sodium: 0, sugar: 0 };

        // ê¸°ë³¸ ì¦ê²¨ì°¾ëŠ” ìŒì‹ë“¤
        const defaultFavoriteFoods = [
            { name: "ğŸ¥› í”Œë ˆì¸ìš”ê±°íŠ¸+ê²¬ê³¼ë¥˜", calories: 180, carbs: 12, protein: 8, fat: 9 },
            { name: "ğŸ í† ìŠ¤íŠ¸+ê³„ë€í›„ë¼ì´", calories: 250, carbs: 20, protein: 12, fat: 8 },
            { name: "ğŸ– ì—„ë§ˆì†ì¹´ì¸ ", calories: 420, carbs: 35, protein: 25, fat: 18 },
            { name: "ğŸ£ í¬ì¼€ë³¼(ì—°ì–´)", calories: 380, carbs: 45, protein: 22, fat: 12 },
            { name: "ğŸ¥— ë‹­ê°€ìŠ´ì‚´ìƒëŸ¬ë“œ", calories: 200, carbs: 8, protein: 25, fat: 5 },
            { name: "ğŸ¥œ ê²¬ê³¼ë¥˜ 30g", calories: 170, carbs: 5, protein: 6, fat: 15 },
            { name: "ğŸŒ¶ï¸ ë§ˆë¼íƒ•", calories: 580, carbs: 45, protein: 20, fat: 35, isStress: true },
            { name: "ğŸ¢ ë–¡ë³¶ì´", calories: 320, carbs: 55, protein: 8, fat: 8, isStress: true }
        ];

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // ê¸°ë³¸ ì¦ê²¨ì°¾ëŠ” ìŒì‹ì´ ì—†ìœ¼ë©´ ì¶”ê°€
            if (favoriteFoods.length === 0) {
                favoriteFoods = defaultFavoriteFoods;
                saveFavoriteFoods();
            }

            loadSettings();
            updateFavoriteFoodsDisplay();
            updateMealDisplay();
            checkGoogleSheetConnection();
            
            // ì‹ì‚¬ ì„ íƒ ì´ë²¤íŠ¸
            document.querySelectorAll('.meal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectMeal(this.dataset.meal);
                });
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function selectMeal(mealType) {
            // í˜„ì¬ ì‹ì‚¬ê°€ ë°”ë€” ë•Œ ì„ì‹œ ì €ì¥ëœ ìŒì‹ë“¤ ì´ˆê¸°í™”
            if (currentMeal !== mealType) {
                currentMealFoods = [];
                currentMeal = mealType;
                
                document.querySelectorAll('.meal-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-meal="${mealType}"]`).classList.add('active');
                
                updateMealDisplay();
            }
        }

        function addFoodToCurrentMeal() {
            const foodData = {
                name: document.getElementById('foodName').value,
                amount: document.getElementById('foodAmount').value,
                unit: document.getElementById('foodUnit').value,
                calories: parseInt(document.getElementById('calories').value) || 0,
                carbs: parseFloat(document.getElementById('carbs').value) || 0,
                protein: parseFloat(document.getElementById('protein').value) || 0,
                fat: parseFloat(document.getElementById('fat').value) || 0,
                sodium: parseFloat(document.getElementById('sodium').value) || 0,
                sugar: parseFloat(document.getElementById('sugar').value) || 0
            };

            if (!foodData.name || !foodData.amount) {
                showAlert('ìŒì‹ ì´ë¦„ê³¼ ì–‘ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!', 'warning');
                return;
            }

            currentMealFoods.push(foodData);
            updateMealDisplay();
            clearFoodInputs();
            showAlert(`${foodData.name}ì´(ê°€) í˜„ì¬ ì‹ì‚¬ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function addFavoriteFoodToMeal(food) {
            const foodData = {
                ...food,
                amount: food.defaultAmount || 1,
                unit: food.defaultUnit || 'ê°œ'
            };
            
            currentMealFoods.push(foodData);
            updateMealDisplay();
            showAlert(`${food.name}ì´(ê°€) í˜„ì¬ ì‹ì‚¬ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function removeFoodFromMeal(index) {
            currentMealFoods.splice(index, 1);
            updateMealDisplay();
        }

        function updateMealDisplay() {
            const mealNames = {
                breakfast: 'ğŸŒ… ì•„ì¹¨',
                lunch: 'â˜€ï¸ ì ì‹¬',
                dinner: 'ğŸŒ™ ì €ë…',
                snack: 'ğŸ¿ ê°„ì‹'
            };

            document.querySelector('.current-meal-title').textContent = `${mealNames[currentMeal]} ë©”ë‰´`;
            
            const listContainer = document.getElementById('currentMealList');
            
            if (currentMealFoods.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ì•„ì§ ì¶”ê°€ëœ ìŒì‹ì´ ì—†ì–´ìš”</div>';
                document.getElementById('saveMealBtn').disabled = true;
            } else {
                let totalCalories = 0;
                listContainer.innerHTML = currentMealFoods.map((food, index) => {
                    totalCalories += food.calories;
                    return `
                        <div class="meal-food-item">
                            <div class="food-info">
                                <div class="food-name">${food.name}</div>
                                <div class="food-details">${food.amount}${food.unit} | íƒ„${food.carbs}g ë‹¨${food.protein}g ì§€${food.fat}g</div>
                            </div>
                            <div class="food-calories">${food.calories}kcal</div>
                            <button class="remove-food-btn" onclick="removeFoodFromMeal(${index})">ğŸ—‘ï¸</button>
                        </div>
                    `;
                }).join('');
                
                // ì´ ì¹¼ë¡œë¦¬ í‘œì‹œ
                listContainer.innerHTML += `
                    <div style="text-align: center; margin-top: 10px; padding: 10px; background: #667eea; color: white; border-radius: 8px; font-weight: bold;">
                        ì´ ${totalCalories}kcal
                    </div>
                `;
                
                document.getElementById('saveMealBtn').disabled = false;
            }
        }

        async function saveMealToGoogleSheets() {
            if (!settings.spreadsheetId) {
                showAlert('ë¨¼ì € êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }

            if (currentMealFoods.length === 0) {
                showAlert('ì €ì¥í•  ìŒì‹ì´ ì—†ìŠµë‹ˆë‹¤!', 'warning');
                return;
            }

            try {
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].substring(0, 5);
                
                const mealNames = {
                    breakfast: 'ğŸŒ… ì•„ì¹¨',
                    lunch: 'â˜€ï¸ ì ì‹¬',
                    dinner: 'ğŸŒ™ ì €ë…',
                    snack: 'ğŸ¿ ê°„ì‹'
                };

                // ê° ìŒì‹ì„ ê°œë³„ í–‰ìœ¼ë¡œ ì €ì¥
                for (const food of currentMealFoods) {
                    const rowData = [
                        dateStr,
                        timeStr,
                        mealNames[currentMeal],
                        food.name,
                        `${food.amount}${food.unit}`,
                        food.calories,
                        food.carbs,
                        food.protein,
                        food.fat,
                        food.sodium,
                        food.sugar,
                        '', // ê¸°ë¶„
                        ''  // ë©”ëª¨
                    ];

                    await appendToGoogleSheet(rowData);
                }

                // ë¡œì»¬ ì´í•© ì—…ë°ì´íŠ¸
                updateDailyTotals();
                
                showAlert(`${mealNames[currentMeal]} ì‹ì‚¬ê°€ êµ¬ê¸€ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (${currentMealFoods.length}ê°œ ìŒì‹)`, 'success');
                
                // ì €ì¥ í›„ í˜„ì¬ ì‹ì‚¬ ì´ˆê¸°í™”
                currentMealFoods = [];
                updateMealDisplay();

            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                showAlert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        async function appendToGoogleSheet(rowData) {
            // ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Google Sheets API ë˜ëŠ” Google Apps Scriptë¥¼ ì‚¬ìš©
            
            // ì—¬ê¸°ì„œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥ (ì‹œë®¬ë ˆì´ì…˜)
            const allData = JSON.parse(localStorage.getItem('sheetData') || '[]');
            allData.push({
                timestamp: new Date().toISOString(),
                data: rowData
            });
            localStorage.setItem('sheetData', JSON.stringify(allData));
            
            console.log('ì‹œíŠ¸ì— ì €ì¥ëœ ë°ì´í„°:', rowData);
        }

        function updateDailyTotals() {
            const allData = JSON.parse(localStorage.getItem('sheetData') || '[]');
            const today = new Date().toISOString().split('T')[0];
            
            dailyTotals = { calories: 0, carbs: 0, protein: 0, fat: 0, sodium: 0, sugar: 0 };
            
            allData.forEach(entry => {
                if (entry.data[0] === today) { // ì˜¤ëŠ˜ ë‚ ì§œ ë°ì´í„°ë§Œ
                    dailyTotals.calories += entry.data[5] || 0;
                    dailyTotals.carbs += entry.data[6] || 0;
                    dailyTotals.protein += entry.data[7] || 0;
                    dailyTotals.fat += entry.data[8] || 0;
                    dailyTotals.sodium += entry.data[9] || 0;
                    dailyTotals.sugar += entry.data[10] || 0;
                }
            });
            
            updateDailySummary();
        }

        function updateDailySummary() {
            document.getElementById('todayCalories').textContent = Math.round(dailyTotals.calories);
            document.getElementById('todayCarbs').textContent = Math.round(dailyTotals.carbs) + 'g';
            document.getElementById('todayProtein').textContent = Math.round(dailyTotals.protein) + 'g';
            document.getElementById('todayFat').textContent = Math.round(dailyTotals.fat) + 'g';
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const calorieProgress = Math.min((dailyTotals.calories / settings.targetCalories) * 100, 100);
            document.getElementById('calorieProgress').style.width = calorieProgress + '%';
        }

        function updateFavoriteFoodsDisplay() {
            const container = document.getElementById('favoriteFoods');
            container.innerHTML = favoriteFoods.map(food => `
                <div class="favorite-food-btn" onclick="addFavoriteFoodToMeal(${JSON.stringify(food).replace(/"/g, '&quot;')})">
                    <div style="font-weight: bold; margin-bottom: 3px;">${food.name}</div>
                    <div style="font-size: 0.7rem; color: #666;">${food.calories}kcal</div>
                </div>
            `).join('');
        }

        function connectGoogleSheet() {
            const sheetId = document.getElementById('spreadsheetId').value.trim();
            
            if (!sheetId) {
                showAlert('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }

            settings.spreadsheetId = sheetId;
            saveSettings();
            
            // í—¤ë” ìƒì„± ì‹œë®¬ë ˆì´ì…˜
            const headers = [
                'ğŸ“… ë‚ ì§œ', 'â° ì‹œê°„', 'ğŸ½ï¸ ì¢…ë¥˜', 'ğŸ“ ìŒì‹ëª…', 'ğŸ“ ì–‘', 
                'ğŸ”¥ ì¹¼ë¡œë¦¬', 'ğŸ íƒ„ìˆ˜í™”ë¬¼(g)', 'ğŸ¥© ë‹¨ë°±ì§ˆ(g)', 'ğŸ§ˆ ì§€ë°©(g)', 
                'ğŸ§‚ ë‚˜íŠ¸ë¥¨(mg)', 'ğŸ¯ ë‹¹ë¶„(g)', 'ğŸ˜Š ê¸°ë¶„', 'ğŸ’­ ë©”ëª¨'
            ];
            
            // í—¤ë”ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ì‹¤ì œë¡œëŠ” êµ¬ê¸€ì‹œíŠ¸ì— ì €ì¥)
            const allData = JSON.parse(localStorage.getItem('sheetData') || '[]');
            if (allData.length === 0) {
                allData.push({
                    timestamp: new Date().toISOString(),
                    data: headers,
                    isHeader: true
                });
                localStorage.setItem('sheetData', JSON.stringify(allData));
            }
            
            checkGoogleSheetConnection();
            showAlert('êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
        }

        function checkGoogleSheetConnection() {
            const indicator = document.getElementById('syncIndicator');
            const status = document.getElementById('syncStatus');
            
            if (settings.spreadsheetId) {
                indicator.className = 'sync-indicator';
                status.textContent = 'êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ê²°ë¨ âœ…';
            } else {
                indicator.className = 'sync-indicator disconnected';
                status.textContent = 'êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—°ê²° í•„ìš” âš ï¸';
            }
        }

        function testConnection() {
            if (!settings.spreadsheetId) {
                showAlert('ë¨¼ì € ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë¥¼ ì…ë ¥í•˜ê³  ì—°ê²°í•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }

            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
            const testData = [
                new Date().toISOString().split('T')[0],
                new Date().toTimeString().split(' ')[0].substring(0, 5),
                'ğŸ§ª í…ŒìŠ¤íŠ¸',
                'ì—°ê²° í…ŒìŠ¤íŠ¸',
                '1ê°œ',
                0, 0, 0, 0, 0, 0,
                'ğŸ˜Š ì¢‹ìŒ',
                'ì—°ê²° í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤'
            ];

            appendToGoogleSheet(testData);
            showAlert('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. ğŸ”', 'success');
        }

        function addFavoriteFood() {
            const name = document.getElementById('newFavoriteFood').value;
            const calories = parseInt(document.getElementById('newFavoriteCalories').value);
            
            if (!name || !calories) {
                showAlert('ìŒì‹ëª…ê³¼ ì¹¼ë¡œë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                return;
            }

            const newFood = {
                name: name,
                calories: calories,
                carbs: 0, // ê¸°ë³¸ê°’
                protein: 0,
                fat: 0,
                sodium: 0,
                sugar: 0
            };

            favoriteFoods.push(newFood);
            saveFavoriteFoods();
            updateFavoriteFoodsDisplay();
            
            document.getElementById('newFavoriteFood').value = '';
            document.getElementById('newFavoriteCalories').value = '';
            
            showAlert(`${name}ì´(ê°€) ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function saveSettings() {
            settings.targetCalories = parseInt(document.getElementById('targetCalories').value) || 1500;
            settings.targetProtein = parseInt(document.getElementById('targetProtein').value) || 70;
            settings.targetWeight = parseFloat(document.getElementById('targetWeight').value) || 65;
            settings.currentWeight = parseFloat(document.getElementById('currentWeight').value) || 77.8;
            
            localStorage.setItem('dietSettings', JSON.stringify(settings));
            showAlert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âš™ï¸', 'success');
        }

        function loadSettings() {
            document.getElementById('targetCalories').value = settings.targetCalories;
            document.getElementById('targetProtein').value = settings.targetProtein;
            document.getElementById('targetWeight').value = settings.targetWeight;
            document.getElementById('currentWeight').value = settings.currentWeight;
            document.getElementById('spreadsheetId').value = settings.spreadsheetId || '';
        }

        function saveFavoriteFoods() {
            localStorage.setItem('favoriteFoods', JSON.stringify(favoriteFoods));
        }

        function clearFoodInputs() {
            ['foodName', 'foodAmount', 'calories', 'carbs', 'protein', 'fat', 'sodium', 'sugar'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('foodUnit').value = 'g';
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.tab-content.active .quick-add-section, .tab-content.active .google-sheets-setup');
            if (container) {
                container.insertBefore(alertDiv, container.firstChild);
                setTimeout(() => alertDiv.remove(), 3000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜¤ëŠ˜ ë°ì´í„° ì—…ë°ì´íŠ¸
        window.addEventListener('load', function() {
            updateDailyTotals();
        });

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ í˜„ì¬ ì‹ì‚¬ ì„ì‹œ ì €ì¥
        window.addEventListener('beforeunload', function() {
            if (currentMealFoods.length > 0) {
                localStorage.setItem('tempMeal_' + currentMeal, JSON.stringify(currentMealFoods));
            }
        });
    </script>
</body>
</html>
